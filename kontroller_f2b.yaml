---
- name: Tjek for bannede IP-adresser i Fail2ban
  hosts: ubuntu_servers
  become: yes
  tasks:
    - name: Tjek bannede IP'er i sshd jail
      shell: fail2ban-client status sshd | grep "Banned IP list"
      register: banned_ips
      changed_when: false

    - name: Vis bannede IP'er
      debug:
        msg: >
          {% if 'Banned IP list:' in banned_ips.stdout %}
          {% set banned_list = banned_ips.stdout.split(': ')[1] %}
          {% if banned_list %}
          FÃ¸lgende IP'er er bannet: {{ banned_list }}
          {% else %}
          Ingen IP'er er blevet bannet.
          {% endif %}
          {% else %}
          Ingen data fundet om bannede IP'er.
          {% endif %}
